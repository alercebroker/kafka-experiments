#+TITLE: Kafka Experiments
#+SETUPFILE: https://fniessen.github.io/org-html-themes/org/theme-readtheorg.setup
* Producer Scale Experiment
<2020-11-24 mar>
- Experiment consisted in running producers in parallel and measure the production rate at its stationary state.
- Producers used the LSST simulator alerts with a limit of 5MB alert size.
- Each run with n producers was repeated 3 times.
** Kafka setup
*** Hardware
| Producers | Instance type | # Brokers | # Cores | RAM (GB) | # Disks | Disk storage |
|-----------+---------------+-----------+---------+----------+---------+--------------|
|         2 | c5a.4xlarge   |         3 |      16 |       32 |       3 |          100 |
|         4 | c5a.4xlarge   |         3 |      16 |       32 |       3 |          100 |
|         8 | c5a.4xlarge   |         3 |      16 |       32 |       3 |          100 |
|        16 | c5a.4xlarge   |         3 |      16 |       32 |       3 |          100 |
|        32 | c5a.4xlarge   |         3 |      16 |       32 |       3 |          100 |

*** Software
Server properties was almost the same for each experiment, only changing the number of partitions to equal the number of producers. [[file:server.properties.producer2][server.properties]]
| Producers | JVM RAM | Replication factor | # Partitions |
|-----------+---------+--------------------+--------------|
|         2 |       5 |                  1 |            2 |
|         4 |       5 |                  1 |            4 |
|         8 |       5 |                  1 |            8 |
|        16 |       5 |                  1 |           16 |
|        32 |       5 |                  1 |           32 |

** Results
The following table shows the aproximate results when the rate reached a stationary state.
| Producers | Messages/s |  MB/s |
|-----------+------------+-------|
|         2 |        294 |  25.6 |
|         4 |        592 |  51.8 |
|         8 |       1152 | 100.7 |
|        16 |       2228 | 195.7 |
|        32 |       3200 | 279.8 |

The following plot shows the mean values for the producer rate at stationary state including all 3 runs of the same configuration.
#+attr_html: :alt  :align left :class img
[[file:producer_exp.png][Experiment results]]
